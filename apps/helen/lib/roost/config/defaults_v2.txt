# start of roost config

base {
  syntax_vsn "2020-08-18"
  config_vsn "0.1.0"
  worker_name "roost"
  timeout PT1M
  timezone "America/New_York"
  start_mode closed
}

workers {
  disco_ball    "roost disco ball"
  el_wire       "roost el wire"
  el_wire_entry "roost el wire entry"
  lights_one    "roost lights sound one"
  lights_three  "roost lights sound three"
  led_forest    "roost led forest"
}

command dance_fade "roost dance fade" random {
    min 64, max 1024, primes 35, step_ms 35, step 27, priority 15
}

command closed_fade "roost closed fade" random {
    min 64, max 512, primes 35, step_ms 35, step 7, priority 15
}

mode dance_with_me {
  next_mode hold
  sequence spin_up, slow_disco_ball, dance

  step spin_up {
    led_forest dance_fade
    disco_ball duty 0.7
    el_wire duty 0.5
    el_wire_entry duty 0.5
    on lights_one, lights_three
  }

  step slow_disco_ball { sleep PT1M; disco_ball duty 0.63 }
  step dance { sleep PT1M }
}

mode leaving {
  next_mode closed; sequence house_lights
  step house_lights {
    off disco_ball, el_wire, lights_one, lights_three
    on led_forest, el_wire_entry
    sleep PT10M
  }
}

mode closed {
  next_mode hold; sequence closed
  step closed {all off; led_forest closed_fade}
}

# end of roost config
