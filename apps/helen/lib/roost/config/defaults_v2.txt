# start of roost config

base {
  syntax_vsn "2020-08-18"
  config_vsn "0.1.0"
  worker_name "roost"
  timeout PT1M
  timezone "America/New_York"
  start_mode closed
}

workers {
  disco_ball    "roost disco ball"
  el_wire       "roost el wire"
  el_wire_entry "roost el wire entry"
  lights_three  "roost lights sound three"
  led_forest    "roost led forest"
  lightdesk     "roost worker"
}

command dance_fade "dance fade" random {
    min 0, max 128, primes 7, step_ms 50, step 3, priority 15
}

command el_fade_main "el fade main" random {
    min 3072, max 4096, primes 35, step_ms 100, step 52, priority 15
}

command el_fade_entry "el fade entry" random {
    min 3072, max 4096, primes 35, step_ms 100, step 52, priority 15
}

command closed_fade "closed fade" random {
    min 64, max 384, primes 35, step_ms 50, step 13, priority 15
}

mode dance_with_me {
  next_mode hold
  sequence spin_up, slow_disco_ball

  step spin_up {
    led_forest dance_fade

    el_wire el_fade_main
    el_wire_entry el_fade_entry

    disco_ball duty 0.7

    on lights_three
    tell lightdesk dance
  }

  step slow_disco_ball { sleep PT1M; disco_ball duty 0.63 }
}

mode leaving {
  next_mode closed; sequence house_lights
  step house_lights {
    off disco_ball
    off el_wire
    off lights_three

    on led_forest
    on el_wire_entry

    tell lightdesk stop
    sleep PT10M
  }
}

mode closed {
  next_mode hold; sequence closed
  step closed {
  all off
  led_forest closed_fade

  tell lightdesk stop}
}

# end of roost config
