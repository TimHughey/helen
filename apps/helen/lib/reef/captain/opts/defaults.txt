# start of reef captain config

base
  syntax_vsn '2020-0817'
  worker_name 'captain'
  description 'reef captain default config'
  timeout PT3M
  timezone America/New_York
  first_mode fill

workers
  air   'mixtank air'
  pump  'mixtank pump'
  rodi  'mixtank rodi'
  mix_heater 'mixtank heater'
  reef_heater 'display tank heater'
  first_mate reef_worker

modes
  all_stop
    next_mode hold
    sequence all_stop
    steps
      all_stop
        all off

  fill
    next_mode keep_fresh
    sequence at_start initial main topoff finally
    steps
      at_start
        all off
      initial for PT3H30M
        rodi on PT2M10S then off
        rodi off PT12M
      main for PT4H
        rodi on PT2M10S then off
        air on PT5M then off nowait
        rodi off PT12M
      topoff
        air off
        rodi on PT5M then off
      finally
        all off

  keep_fresh
    next_mode hold
    sequence init circulate aerate power_save repeat
    steps
      init
        all off
        sleep PT10S
      circulate
        pump on PT2M then off
      aerate
        air on PT3M then off
      power_save
        sleep PT10M

  add_salt
    next_mode match_conditions
    sequence init add mix finally
    steps
      init
        air off
      add
        pump on PT20M then off
      mix for PT30M
        air on PT3M then off
        pump on PT5M then off
      finally
        air off
        pump off

  match_conditions
    next_mode dump_water
    sequence warm stir power_save repeat
    steps
      warm
        tell mix_heater active
      stir
        pump on PT1M then off
        air on PT4M then off
        pump off PT5M
      power_save
        sleep PT5M

  dump_water
    next_mode load_water
    sequence at_start adjust_valves pump_to_sewer
    steps
      at_start
        air off
        pump off
        tell reef_heater standby
        tell first_mate clean
      adjust_valves
        sleep PT30S
      pump_to_sewer
        pump on PT2M17S then off

  load_water
    next_mode final_check
    sequence at_start adjust_valves pump_to_reef
    steps
      at_start
        pump off
        tell mix_heater standby
        tell reef_heater standby
        tell first_mate clean
      adjust_valves
        sleep PT45S
      pump_to_reef
        pump on PT2M17S then off

  final_check
    next_mode fill
    sequence at_start check normal_operations
    steps
      at_start
        all off
      check
        sleep PT10M
      normal_operations
        tell reef_heater active
        tell first_mate normal_operations

# end of config
